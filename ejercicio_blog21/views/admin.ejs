<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Clean Blog - Start Bootstrap Theme</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script
      src="https://use.fontawesome.com/releases/v5.15.4/js/all.js"
      crossorigin="anonymous"
    ></script>
    <!-- Google fonts-->
    <link
      href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
      rel="stylesheet"
      type="text/css"
    />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="/css/styles.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Navigation-->
    <%- include('partials/navbar'); %>

    <!-- Page Header -->
    <%- include('partials/header'); %>
    <!-- Main Content -->
    <main class="mb-4">
      <div class="container px-4 px-lg-5">
        <div class="d-flex align-items-start flex-wrap mb-2">
          <h3 style="flex: 1; min-width: 500px;" >Lista de <%= currentUser.role.content === "Escritor" ? "tus articulos" : "articulos del blog" %></h3>
          <a href="/admin/crear" class="btn btn-success text-uppercase" id="submitBtn">New Article</a>
        </div>

        <table class="table table-striped border p-2">
          <thead>
            <tr>
              <th scope="col">Title</th>
              <th class="d-none d-md-block" scope="col">Article</th>
              <% if( currentUser.role.content !== "Escritor" ){ %>
                <th scope="col">Author</th>
              <% } %>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% for (const article of articles) { %>
            <tr>
              <td><%= article.title %></td>
              <td class="d-none d-md-block elipsis"><%= article.content.substring(0, 100) %></td>
              <% if( currentUser.role.content === "Administrador" || currentUser.role.content === "Editor" ){ %>
                <td><%= article.user.firstname %> <%= article.user.lastname %></td>
              <% } %>

              <td class="d-flex flex-column">
                <a href="/admin/editar/<%= article.id %>">
                  <button class="btn btn-sm btn-primary text-uppercase w-100">Edit</button>
                </a>
                
                <% if( currentUser.role.content === "Administrador" || currentUser.role.content === "Escritor" ){ %>
                  <a href="/admin/eliminar/<%= article.id %>">
                    <button class="btn btn-sm btn-danger text-uppercase w-100 mt-1">Delete</button>
                  </a>
                <% } %>
              </td>
            </tr>
            <% } %>

            <!-- <td colspan="2">Larry the Bird</td> -->
          </tbody>
        </table>

        <% if ( currentUser.role.content === "Administrador" ) { %>
          <h3 class="mt-2" >Lista de usuarios del blog</h3>
          <table class="table table-striped border p-2" >
            <thead>
              <tr>
                <th scope="col">id</th>
                <th scope="col">Firstname</th>
                <th scope="col">Lastname</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% for (const user of usersList) { %>
                <tr>
                  <td><%= user.id %></td>
                  <td><%= user.firstname %></td>
                  <td><%= user.lastname %></td>
                  <td>
                    <a href="/admin/eliminar-usuario/<%= user.id %>">
                      <button class="btn btn-sm btn-danger text-uppercase w-100 mt-1">Delete</button>
                    </a>
                  </td>
                </tr>
              <% } %>
            </tbody>
          </table>
        <% } %>

      </div>
    </main>
    <!-- Footer-->
    <%- include('partials/footer') %>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
    <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
    <!-- * *                               SB Forms JS                               * *-->
    <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
    <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
    <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
  </body>
</html>
